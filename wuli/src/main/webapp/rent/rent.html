<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.css">
    <link rel="stylesheet" href="/wuli/rent/rent.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Icons">
    <script src="./js/jquery.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.js"></script>
    <script src="/wuli/rent/roomType.js"></script>
    <title>房契管理</title>
</head>
<body>

    <div class="container-fluid border p-5 mt-5">
        <div class="row">
            <div class="col-md-4 col-12 room-type-select">
                    <!-- 房型資訊 -->
                <hgroup class="justify-content-center">
                    <h2  style="margin-top: 25px;
                                margin-left: 40px;
                                display: block;">房型資訊</h2>
                        <div class="d-flex flex-column select-block">
                            <div class="bg-white w-75 ms-auto me-auto border select-regin">
                                <div class="text-center"> 
                                    <span>大樓：</span>
                                    <select class="w-50 text-center form-select form-select-sm d-inline" id="room-building">
                                        <option value="0">請選擇</option>
                                        <option value="C">C</option>
                                        <option value="E">E</option>
                                    </select>
                                </div>
                            </div>
                            <div class="bg-white w-75 ms-auto me-auto border select-regin">
                                <div class="text-center"> 
                                    <span>房型：</span>
                                    <select class="w-50 text-center form-select form-select-sm d-inline" id="room-type"> <!-- onchange="changeRoomType()" -->   
                                        <option value="0">請選擇</option>
                                        <option value="A">單人A</option>
                                        <option value="B">單人B</option>
                                        <option value="C">單人C</option>
                                        <option value="D">雙人A</option>
                                        <option value="E">雙人B</option>
                                        <option value="F">雙人C</option>
                                    </select>
                                </div>
                            </div>
                            <div class="bg-white w-75 ms-auto me-auto border select-regin">
                                <div class="text-center"> 
                                    <span>樓層：</span>
                                    <select class="w-50 text-center form-select form-select-sm d-inline " id="room-floor">
                                        <option value="0">請選擇</option>
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                        <option value="5">5</option>
                                        <option value="6">6</option>
                                        <option value="7">7</option>
                                        <option value="8">8</option>
                                    </select>
                                </div>
                            </div>
                            <div class="bg-white w-75 ms-auto me-auto border select-regin">
                                <div class="text-center"> 
                                    <span>位置：</span>
                                    <select class="w-50 text-center form-select form-select-sm d-inline" id="room-position">
                                        <option value="0">請選擇</option>
                                        <option name="room-position1" value="L">左</option>
                                        <option name="room-position2" value="R">右</option>
                                    </select>
                                </div>
                            </div>
                            <div class="bg-white w-75 ms-auto me-auto border select-regin">
                              <div class="text-center">
                                <span class="w-25">價格　:　</span>
                                <span class="w-75 text-center" id="room-price">------</span>
                              </div>
                            </div>
                            <div class="bg-white w-75 ms-auto me-auto border select-regin">
                              <div class="text-center">
                                <span class="w-25">大小　:　</span>
                                <span class="w-75 text-center" id="room-size">------</span>
                              </div>
                            </div>
                            <div class="bg-white w-75 ms-auto me-auto border select-regin">
                              <div class="text-center">
                                <span class="w-25">狀態　:　</span>
                                <span class="w-75 text-center" id="room-status">------</span>
                              </div>
                            </div>
                        </div>
                    </hgroup>
                </div>

         <!-- 租客資訊 -->
                <div class="col-md-8 col-12"> 
                    <div class="border tenant-information"> 
                        <div class="d-flex pt-5">
                            <h2 class="mx-5">租客資訊</h2> <span id="renterUid" style=""></span>
                            <input onclick="addRent()" type="image" src="../wuli/img/add.png" alt="加入" title="加入" width="25px" class="my-auto mx-4" >
                            <input onclick="contractRent()" type="image" src="../wuli/img/stamp.png" alt="合約" title="合約" width="25px" class="my-auto mt-2" >
                        </div>
                        <hr>
                        <p></p>

                        <form action="" method="" class="px-5 pb-3" id="theForm">
                            <div class="form-group d-flex" id="renter">
                                <label for="theForm" class="control-label text-nowrap my-auto">承租人 ：</label>
                                <input class="form-control" type="text" id="inputRenter" name="inputRenter" >
                            </div>
                            <p></p>
                            <div class="form-group d-flex">
                                <label for="theForm" class="control-label text-nowrap my-auto">租賃期間 ：</label>
                                <input class="form-control" type="date" id="inputStart" name="inputStart" placeholder="YYY">
                                <p class="mx-1 my-auto">-</p>
                                <input class="form-control" type="date" id="inputEnd" name="inputEnd" placeholder="YYY">
                            </div>
                            <p></p>
                            <div class="form-group d-flex">
                                <label for="theForm" class="control-label text-nowrap my-auto">租金 ： </label>
                                <p id="inputRent" name="inputRent" class="control-label text-nowrap my-auto"></p>
                            </div>
                            <p></p>
                            <div class="form-group d-flex">
                                <label for="theForm" class="control-label text-nowrap my-auto">押金 ： </label>
                                <p id="inputDeposit" name="inputDeposit" class="control-label text-nowrap my-auto"></p>
                            </div>
                            <p></p>
                            <div class="form-group d-flex">
                                <label for="theForm" class="control-label text-nowrap my-auto">身分證字號 ：</label>
                                <input class="form-control" type="text" id="inputID" name="inputID">
                            </div>
                            <p></p>
                            <div class="form-group d-flex">
                                <label for="theForm" class="control-label text-nowrap my-auto">電話 ：</label>
                                <input class="form-control" type="text" id="inputPhone" name="inputPhone">
                            </div>
                            <p></p>
                            <div class="form-group d-flex">
                                <label for="theForm" class="control-label text-nowrap my-auto">住址 ：</label>
                                <input class="form-control" type="text" id="inputAddress" name="inputAddress">
                            </div>
                            <p></p>
                            <div class="form-group d-flex">
                                <label for="theForm" class="control-label text-nowrap my-auto">連帶保證人 ：</label>
                                <input class="form-control" type="text" id="inputGuarntor" name="inputGuarntor">
                            </div>
                            <p></p>
                            <div class="form-group d-flex">
                                <label for="theForm" class="control-label text-nowrap my-auto">保證人身分證字號 ：</label>
                                <input class="form-control" type="text" id="inputGuarntorID" name="inputGuarntorID">
                            </div>
                            <p></p>
                            <div class="form-group d-flex">
                                <label for="theForm" class="control-label text-nowrap my-auto">保證人電話 ：</label>
                                <input class="form-control" type="text" id="inputGuarntorPhone" name="inputGuarntorPhone">
                            </div>
                            <p></p>
                            <div class="form-group d-flex">
                                <label for="theForm" class="control-label text-nowrap my-auto">保證人住址 ：</label>
                                <input class="form-control" type="text" id="inputGuarntorAddress" name="inputGuarntorAddress">
                            </div>
                        </form>
                        <p></p>
                    </div>
                </div>
            </div>
        </div>

        <div class="container-fluid d-none" id="room-type-main">
            <div class="room-type-main-block row align-items-center ">
                <div class="room-type-main-side-block col-md-6 col-12  ">
                    <div class="room-type-side-regin pt-0 pt-0">
                        <div class="d-flex align-middle mt-2 ">
                            <div id="carouselExampleIndicators"
                                 class="carousel slide ms-auto me-auto mt-auto mb-auto "
                                 data-bs-ride="carousel">
                                <div class="carousel-indicators mt-auto mb-auto">
                                    <button type="button" data-bs-target="#carouselExampleIndicators"
                                            data-bs-slide-to="0" class="active" aria-current="true"
                                            aria-label="Slide 1"></button>
                                    <button type="button" data-bs-target="#carouselExampleIndicators"
                                            data-bs-slide-to="1" aria-label="Slide 2"></button>
                                    <button type="button" data-bs-target="#carouselExampleIndicators"
                                            data-bs-slide-to="2" aria-label="Slide 3"></button>
                                </div>
                                <div class="carousel-inner mt-5 " id="img-slide-block">
                                    <!-- 裡面內容用JS動態產生-->
                                </div>
                                <button class="carousel-control-prev" type="button"
                                        data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">
                                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                    <span class="visually-hidden">Previous</span>
                                </button>
                                <button class="carousel-control-next" type="button"
                                        data-bs-target="#carouselExampleIndicators" data-bs-slide="next">
                                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                    <span class="visually-hidden">Next</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="room-type-main-side-block col-md-6 col-12">
                    <div class="p-1 room-type-side-regin">
                        <div class="pt-2">
                            <h5> 房間設備： </h5>
                            <span class="row d-flex justify-content-around align-items-center">
                                <span class="col-2 text-center">
                                    <span class="row material-icons ">tv</span>
                                    <div class="row">
                                        <div class="col text-center">電視 </div>
                                    </div>
                                </span>
                                <span class="col-2 text-center">
                                    <span class="row material-icons">shower</span>
                                    <div class="row">
                                        <div class="col text-center text-nowrap">熱水器</div>
                                    </div>
                                </span>
                                <span class="col-2 text-center">
                                    <span class="material-icons">air</span>
                                    <div class="row">
                                        <div class="col text-center">冷氣</div>
                                    </div>
                                </span>
                                <span class="col-2 text-center">
                                    <span class="material-icons">kitchen</span>
                                    <div class="row">
                                        <div class="col text-center">冰箱</div>
                                    </div>
                                </span>
                                <span class="col-2 text-center">
                                    <span class="col material-icons text-center">window</span>
                                    <div class="row">
                                        <div class="col text-center">紗窗</div>
                                    </div>
                                </span>
                            </span>
                            <hr>
                            <span class="row d-flex justify-content-around ">
                                <span class="col-2 text-center">
                                    <span class="material-icons">chair_alt</span>
                                    <div class="row">
                                        <div class="col text-center" id="room-item-chair"></div>
                                    </div>
                                </span>
                                <span class="col-2 text-center ">
                                    <span class="row material-icons">single_bed</span>
                                    <div class="row">
                                        <div class="col text-center text-nowrap " id="room-item-bed"></div>
                                    </div>
                                </span>
                                <span class="col-2 text-center">
                                    <span class="row material-icons ">desk</span>
                                    <div class="row">
                                        <div class="col text-center text-nowrap" id="room-item-desk"></div>
                                    </div>
                                </span>
                                <span class="col-2 text-center">
                                    <span class="row material-icons ">all_inbox</span>
                                    <div class="row">
                                        <div class="col text-center text-nowrap  " id="room-item-sideTable"></div>
                                    </div>
                                </span>
                                <span class="col-2 text-center">
                                    <span class="row material-icons">door_sliding</span>
                                    <div class="row">
                                        <div class="col text-center" id="room-item-wardrobe"></div>
                                    </div>
                                </span>
                                <span class="col-2 text-center  d-none" id="room-item-balcony">
                                    <span class="row material-icons">balcony</span>
                                    <div class="row">
                                        <div class="col text-center">陽台</div>
                                    </div>
                                </span>
                            </span>
                            <hr>
                            <h5 > 公共設施： </h5>
                            <span class="row d-flex justify-content-around ">
                                <span class="col-2 text-center">
                                    <span class="material-icons">elevator </span>
                                    <div class="row">
                                        <div class="col text-center">電梯</div>
                                    </div>
                                </span>
                                <span class="col-2 text-center">
                                    <span class="material-icons">on_device_training </span>
                                    <div class="row">
                                        <div class="col text-center">投幣式洗衣機</div>
                                    </div>
                                </span>
                                <span class="col-2 text-center">
                                    <span class="material-icons">local_laundry_service </span>
                                    <div class="row">
                                        <div class="col text-center">投幣式烘衣機</div>
                                    </div>
                                </span>
                                <span class="col-2 text-center">
                                    <span class="material-icons">wifi </span>
                                    <div class="row">
                                        <div class="col text-center">無線網路</div>
                                    </div>
                                </span>
                                <span class="col-2 text-center"><!--湊數用來排版--></span>
                            </span>
                        </div>
                    </div>
                </div>

                <div class="room-type-notice">
                    <div class="h5">說明</div>
                    <ol>
                        <li>每份合約的租約期限皆為每年的6月30號，若欲一次簽訂兩年以上，則需簽署多份合約。</li>
                        <li>房租已包含水費、網路費以及管理費，租客無須再額外支付相關費用。</li>
                        <li>電費採台電計價，請自行於每奇數月份（1、3、5、7、9、11﹚下旬至管理員室領取帳單，並自行繳納；若因遲繳而導致斷電情況發生，業者無需承擔任何責任。</li>
                        <li>山水苑有專用的垃圾丟棄區，各位租客無須追垃圾車；請各位租戶在垃圾打包時做好垃圾分類，並以現場標誌指示放置。</li>
                        <li>簽約時請備妥兩個月份租金；可現金支付、也可於現場出示轉帳證明(手機截圖或轉帳單據)。</li>
                        <li>請愛惜使用房內間所有物品，若經檢驗後並非自然損壞而是人為因素造成，則會收取費用。</li>
                    </ol>
                </div>
            </div>
        </div>
    </body>
    
<script>
    function addRent() {
    	const idNumber = window.prompt("請輸入身分證字號");
    //	var idnumber = prompt("請輸入身分證字號:", "");
         if (idNumber !== null || "") {
        //	 console.log(idnumber);
        //request.parameper("id",idnumber);
        
           $.ajax({
        	     url:"/wuli/rent.do",
        	     type:"POST",
        	     data:{"id":idNumber},
        	     success:function(response){
        	    //	 console.log(response)
              //   console.log(response.renterName)
                 document.getElementById("inputRenter").value = response.renterName;
                 document.getElementById("inputID").value = response.renterIdNumber;
                 document.getElementById("inputPhone").value = response.renterPhone;
                 document.getElementById("inputAddress").value = response.renterAddress;
                 document.getElementById("inputGuarntor").value = response.guarntorName;
                 document.getElementById("inputGuarntorID").value = response.guarntorIdNumber;
                 document.getElementById("inputGuarntorPhone").value = response.guarntorPhone;
                 document.getElementById("inputGuarntorAddress").value = response.guarntorAddress;
                 document.getElementById("renterUid").value = response.uId;
        	     },
        	  	 err: function(){
        		   console.error("error")}
           })
         } 
    }
</script>
<script>
	  var storage = localStorage;
function contractRent(){    
    var renter = document.getElementById("inputRenter").value;
    var inputStart = document.getElementById("inputStart").value;
    var startYYY = inputStart.substr(0,4)-1911;
    var startMM = inputStart.substr(5,2);
    var startDD = inputStart.substr(8,2); 
    var inputEnd = document.getElementById("inputEnd").value;
    var endYYY = inputEnd.substr(0,4)-1911; 
    var endMM = inputEnd.substr(5,2);
    var endDD = inputEnd.substr(8,2); 
    var rent = document.getElementById("inputRent").innerHTML;
    var deposit = document.getElementById("inputDeposit").innerHTML;
    var ID = document.getElementById("inputID").value;
    var phone = document.getElementById("inputPhone").value;
    var address = document.getElementById("inputAddress").value;
    var guarntor = document.getElementById("inputGuarntor").value;
    var guarntorID = document.getElementById("inputGuarntorID").value;
    var guarntorPhone = document.getElementById("inputGuarntorPhone").value;
    var guarntorAddress = document.getElementById("inputGuarntorAddress").value;
    var roomBuilding = document.getElementById("room-building").value;
    var roomPosition = document.getElementById("room-position").value;
    var roomFloor = document.getElementById("room-floor").value;
    var roomType = document.getElementById("room-type").value;
    var roomNumber = roomBuilding + roomPosition + roomFloor + roomType ;
    var pdfName = startYYY + roomBuilding + roomPosition + roomFloor + roomType ;
    var rentUid = document.getElementById("renterUid").value;
    var startYYYY = inputStart.substr(0,4);
    var endYYYY = inputEnd.substr(0,4);
    var roomStatus = document.getElementById("room-status").innerHTML;
    

/* 檢查空格 */
    if (!(
        renter &&
        inputStart &&
        inputEnd &&
        rent &&
        deposit &&
        ID &&
        phone &&
        address &&
        guarntor &&
        guarntorID &&
        guarntorPhone &&
        guarntorAddress
    )){
        alert("請填寫完整!");
        return false;
    } 
/* 檢查房間是否未租*/   
    if(roomStatus !='未租賃'){
        alert("房間租賃中");
        return false;
      }
/* 檢查合約日期是否合理 */
    let date = new Date(); 
    let curYYYY = date.getFullYear();
    let curMM = String(date.getMonth() + 1).padStart(2, '0');
    let curDD = String(date.getDate()).padStart(2, '0');
    
    var today = curYYYY+curMM+curDD+"";
    console.log(today);
    var start = $('#inputStart').val().replaceAll('-','');
    if(parseInt(start)  - parseInt(today) < 0){
       alert("起始日期不能小於當天日期")
       return false;
    }
        
    var end = $('#inputEnd').val().replaceAll('-','');
      if(parseInt(start) -  parseInt(end) > 0){
    	  alert("结束日期不能小於起始日期");
        return false;
      }

    
    
    const contract = {
    		  renter,
    		  startYYY,
    		  startMM,
    		  startDD,
    		  endYYY,
    		  endMM,
    		  endDD,
    		  rent,
    		  deposit,
    		  ID,
    		  phone,
    		  address,
    		  guarntor,
    		  guarntorID,
    		  guarntorPhone,
    		  guarntorAddress,
    		  roomBuilding,
    		  roomPosition,
    		  roomFloor,
    		  roomType,
    		  roomNumber,
    		  pdfName,
    		  rentUid,
    		  startYYYY,
    		  endYYYY
    		}
    		storage.setItem("contract", JSON.stringify(contract))
    
    storage.setItem("renter",renter)
    storage.setItem("startYYY",startYYY)
    storage.setItem("startMM",startMM)
    storage.setItem("startDD",startDD)
    storage.setItem("endYYY",endYYY)
    storage.setItem("endMM",endMM)
    storage.setItem("endDD",endDD)
    storage.setItem("rent",rent)
    storage.setItem("deposit",deposit)
    storage.setItem("ID",ID)
    storage.setItem("phone",phone)
    storage.setItem("address",address)
    storage.setItem("guarntor",guarntor)
    storage.setItem("guarntorID",guarntorID)
    storage.setItem("guarntorPhone",guarntorPhone)
    storage.setItem("guarntorAddress",guarntorAddress)
    storage.setItem("roomBuilding",roomBuilding)
    storage.setItem("roomPosition",roomPosition)
    storage.setItem("roomFloor",roomFloor)
    storage.setItem("roomType",roomType)
    storage.setItem("pdfName",pdfName)
    storage.setItem("rentUid",rentUid)
    storage.setItem("startYYYY",startYYYY)
    storage.setItem("endYYYY",endYYYY)

    window.location.href='/wuli/rent/contract.jsp';    
}

</script>

</html>